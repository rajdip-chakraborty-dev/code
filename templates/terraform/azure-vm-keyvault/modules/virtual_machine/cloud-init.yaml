#cloud-config
package_update: true
package_upgrade: true

packages:
  - curl
  - wget
  - git
  - unzip
  - apt-transport-https
  - ca-certificates
  - gnupg
  - lsb-release

# Install Azure CLI
runcmd:
  - curl -sL https://aka.ms/InstallAzureCLIDeb | bash
  - az --version
  - echo "Azure CLI installed successfully"

# Create a welcome message
write_files:
  - content: |
      #!/bin/bash
      echo "Welcome to your Azure VM!"
      echo "VM provisioned by Terraform"
      echo "Admin user: ${admin_username}"
      echo "Azure CLI installed and ready to use"
    path: /home/${admin_username}/welcome.sh
    permissions: '0755'
    owner: ${admin_username}:${admin_username}

final_message: "Cloud-init setup complete. VM is ready for use."
